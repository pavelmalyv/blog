import{j as e,r as d,u as k,a as se,b as P}from"./index-Dcm5Iqju.js";import{u as $,E as Q,a as V,M as Y,P as te,l as re,b as T}from"./PostsList-Dldm9ZGn.js";import{S as G,V as K,M as _}from"./Section-8tLrx2Qc.js";import{c as B}from"./index-DTiIk4fU.js";import{L as ae,F as ne}from"./Field-LMMmwig5.js";import{I as oe}from"./createCompoundContext-09gdrW1o.js";import{u as le,g as ce,a as ie,b as E,P as de}from"./useValidatePaginationTotal-B1rRio14.js";import{H as ue}from"./Heading-DlckqEQG.js";import{u as he}from"./useTitle-DWc_W_yW.js";import"./error-B3qI_Gt9.js";const ge="_list_1ii5u_1",me="_item_1ii5u_13",U={list:ge,item:me},Se=()=>{let s=Array(4).fill(null),t;const{data:r,isLoading:o,isError:l}=$({limit:4,skip:0,sortBy:"views",order:"desc"});!o&&r&&(s=r.posts,t=r.total);const c=["dynamic-height","small-horizontal","small-horizontal","large"];return e.jsx(G,{title:"Popular blog posts",children:e.jsx(K,{isFetching:o,hiddenMessage:_.postsLoading,children:e.jsx(Q,{isError:l,errorMessage:V.postsLoad,children:t===0?e.jsx(Y,{message:_.postsEmpty}):e.jsx("ul",{className:U.list,children:s.map((u,h)=>{const n=u?u.id:h;return e.jsx("li",{className:U.item,children:e.jsx(te,{post:u,styleCard:c[h]})},n)})})})})})},pe={"filter-select-group":"_filter-select-group_qdxr4_9"},xe="_filter_h2b9y_1",je={filter:xe},fe=({children:s})=>e.jsx("div",{className:je.filter,children:s}),_e="_search_bex4j_1",be={search:_e},ye=({children:s,className:t,...r})=>e.jsx("form",{role:"search",className:B(be.search,t),...r,children:s}),Pe="_body_88h4l_1",Ee="_select_88h4l_8",Fe="_icon_88h4l_28",M={body:Pe,select:Ee,icon:Fe},S=({label:s,isLabelHidden:t,className:r,children:o,...l})=>{const c=d.useId();return e.jsxs("div",{children:[e.jsx(ae,{htmlFor:c,isLabelHidden:t,children:s}),e.jsxs("div",{className:M.body,children:[e.jsx("select",{id:c,className:B(M.select,r),...l,children:o}),e.jsx("div",{className:M.icon,children:e.jsx(oe,{children:"keyboard_arrow_down"})})]})]})},Le=({children:s,...t})=>e.jsx("option",{...t,children:s});S.Option=Le;const Re="_result_1kbdo_1",ve={result:Re},Ce=({field:s,lastQuery:t,total:r})=>e.jsx(e.Fragment,{children:s.length>0&&t&&r?e.jsx("div",{className:B(ve.result,"h4"),children:_.postsFound(t,r)}):null}),Oe=["asc","desc"],H=s=>{const t=s.split("|"),r=t[0],o=t.length===2?t[1]:void 0;return[r,Oe.find(l=>l===o)]},q=(s,t)=>`${s}|${t}`,A="q",Ne=s=>{var a;const[t,r]=k(),o=(a=t.get(A))==null?void 0:a.slice(0,s),[l,c]=d.useState(o??""),[u,h]=d.useState(o),n=d.useMemo(()=>re.debounce(h,300),[]);d.useEffect(()=>()=>n.cancel(),[n]);const g=d.useCallback(p=>{const i=p.target.value;r(m=>(i.length===0?m.delete(A):m.set(A,i),m),{replace:!0,preventScrollReset:!0}),c(i),n(i)},[r,n]);return{searchDebounced:u,searchField:l,handleSearch:g}},F="sortBy",L="order",Me=s=>{const[t,r]=k(),o=q(t.get(F)??"",t.get(L)??""),l=s.find(a=>a===o),[c,u]=d.useState(l??s[0]),[h,n]=H(c);d.useEffect(()=>{l||r(a=>(a.delete(F),a.delete(L),a),{replace:!0,preventScrollReset:!0})},[l,r]);const g=d.useCallback(a=>{const p=a.target.value;u(p);const[i,m]=H(p);m&&r(x=>(p===s[0]?(x.delete(F),x.delete(L)):(x.set(F,i),x.set(L,m)),x),{replace:!0,preventScrollReset:!0})},[r,s]);return{sortBy:h,order:n,sortSelectValue:c,handleChangeSort:g}},R="limit",Ae=s=>{const[t,r]=k(),o=Number(t.get(R)??""),l=s.find(n=>n===o),[c,u]=d.useState(l??s[0]);d.useEffect(()=>{c||r(n=>(n.delete(R),n),{replace:!0,preventScrollReset:!0})},[c,r]);const h=d.useCallback(n=>{const g=Number(n.target.value);u(g),r(a=>(g===s[0]?a.delete(R):a.set(R,String(g)),a),{replace:!0,preventScrollReset:!0})},[r,s]);return{limit:c,handleChangeLimit:h}},w=30,v=["id|desc","id|asc","views|desc"],j=[9,18,36],ke=()=>{const s=se(),[t,r]=le(s.pagination,P.base),{searchDebounced:o,searchField:l,handleSearch:c}=Ne(w),{sortBy:u,order:h,sortSelectValue:n,handleChangeSort:g}=Me(v),{limit:a,handleChangeLimit:p}=Ae(j);let i,m=Array(a).fill(null);const x=ce(t,a),{data:C,isLoading:z,isFetching:b,isError:X}=$({limit:a,skip:x,search:o,sortBy:u,order:h},{skip:!r});!z&&C&&(m=C.posts,i=C.total);const O=ie({limit:a,total:i,currentPage:t,paginationUrlCallback:f=>P.pagination(f)}),{isFetching:D}=E(O,b),{isFetching:J}=E(a,b),{isFetching:W}=E(q(u,h??""),b),{isFetching:Z,isLoadingDelay:ee,lastQuery:N}=E(o,b),I=D||J||W||Z,y=d.useId();return e.jsxs(G,{title:"All blog posts",children:[e.jsxs(fe,{children:[e.jsx(ye,{"aria-label":"Blog search",onSubmit:f=>f.preventDefault(),children:e.jsx(ne,{type:"search",icon:"search",name:"search",placeholder:"Enter your query",value:l,label:"Search posts",onChange:c,maxLength:w,isLoading:ee,"aria-controls":y})}),e.jsxs("div",{className:pe["filter-select-group"],children:[e.jsxs(S,{label:"Sort by",value:n,onChange:g,"aria-controls":y,children:[e.jsx(S.Option,{value:v[0],children:"Newest to oldest"}),e.jsx(S.Option,{value:v[1],children:"Oldest to newest"}),e.jsx(S.Option,{value:v[2],children:"Most interesting"})]}),e.jsxs(S,{label:"Show by",value:String(a),onChange:p,"aria-controls":y,children:[e.jsx(S.Option,{value:String(j[0]),children:j[0]}),e.jsx(S.Option,{value:String(j[1]),children:j[1]}),e.jsx(S.Option,{value:String(j[2]),children:j[2]})]})]})]}),e.jsx(K,{id:y,isFetching:I,hiddenMessage:_.postsLoading,children:e.jsxs(Q,{isError:X,errorMessage:V.postsLoad,children:[e.jsx(Ce,{field:l,lastQuery:N,total:i}),e.jsx(T,{isFetching:I,children:i===0&&N?e.jsx(Y,{message:_.postsNotFound(N)}):e.jsx(T.Posts,{posts:m,stretchLast:!0})}),O&&i?e.jsx(de,{limit:a,total:i,currentPage:O,urlBase:P.base,urlCallback:f=>P.pagination(f),isLoading:D}):null]})})]})},Ye=()=>(he("Home"),e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"The blog"}),e.jsx(Se,{}),e.jsx(ke,{})]}));export{Ye as default};
