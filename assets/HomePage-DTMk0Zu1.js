import{j as e,r as d,u as k,a as se,b as P}from"./index-DLH5Ul2T.js";import{u as $,E as Q,a as V,M as Y,P as te,l as re,b as T}from"./PostsList-Py_aBx7g.js";import{S as G,V as K,M as b}from"./Section-BBC1iNCV.js";import{c as I}from"./index-CNxsZp_G.js";import{L as ae,F as ne}from"./Field-DwGPljH_.js";import{I as oe}from"./createCompoundContext-0RAH04gy.js";import{u as le,g as ce,a as ie,b as E,P as de}from"./useValidatePaginationTotal-CaKyo-PJ.js";import{H as ue}from"./Heading-BMLPHb_R.js";import{u as he}from"./useTitle-DdiE5ZtU.js";import"./error-BJhP6n4l.js";const ge="_list_1ii5u_1",me="_item_1ii5u_13",U={list:ge,item:me},Se=({isAboveTheFold:s})=>{let t=Array(4).fill(null),r;const{data:l,isLoading:n,isError:c}=$({limit:4,skip:0,sortBy:"views",order:"desc"});!n&&l&&(t=l.posts,r=l.total);const g=["dynamic-height","small-horizontal","small-horizontal","large"];return e.jsx(G,{title:"Popular blog posts",children:e.jsx(K,{isFetching:n,hiddenMessage:b.postsLoading,children:e.jsx(Q,{isError:c,errorMessage:V.postsLoad,children:r===0?e.jsx(Y,{message:b.postsEmpty}):e.jsx("ul",{className:U.list,children:t.map((u,o)=>{const h=u?u.id:o;return e.jsx("li",{className:U.item,children:e.jsx(te,{post:u,styleCard:g[o],isImageEager:s&&o==0})},h)})})})})})},pe={"filter-select-group":"_filter-select-group_qdxr4_9"},xe="_filter_h2b9y_1",je={filter:xe},fe=({children:s})=>e.jsx("div",{className:je.filter,children:s}),be="_search_bex4j_1",_e={search:be},ye=({children:s,className:t,...r})=>e.jsx("form",{role:"search",className:I(_e.search,t),...r,children:s}),Pe="_body_88h4l_1",Ee="_select_88h4l_8",Fe="_icon_88h4l_28",A={body:Pe,select:Ee,icon:Fe},S=({label:s,isLabelHidden:t,className:r,children:l,...n})=>{const c=d.useId();return e.jsxs("div",{children:[e.jsx(ae,{htmlFor:c,isLabelHidden:t,children:s}),e.jsxs("div",{className:A.body,children:[e.jsx("select",{id:c,className:I(A.select,r),...n,children:l}),e.jsx("div",{className:A.icon,children:e.jsx(oe,{children:"keyboard_arrow_down"})})]})]})},Le=({children:s,...t})=>e.jsx("option",{...t,children:s});S.Option=Le;const ve="_result_1kbdo_1",Re={result:ve},Ce=({field:s,lastQuery:t,total:r})=>e.jsx(e.Fragment,{children:s.length>0&&t&&r?e.jsx("div",{className:I(Re.result,"h4"),children:b.postsFound(t,r)}):null}),Oe=["asc","desc"],H=s=>{const t=s.split("|"),r=t[0],l=t.length===2?t[1]:void 0;return[r,Oe.find(n=>n===l)]},q=(s,t)=>`${s}|${t}`,M="q",Ne=s=>{var a;const[t,r]=k(),l=(a=t.get(M))==null?void 0:a.slice(0,s),[n,c]=d.useState(l??""),[g,u]=d.useState(l),o=d.useMemo(()=>re.debounce(u,300),[]);d.useEffect(()=>()=>o.cancel(),[o]);const h=d.useCallback(p=>{const i=p.target.value;r(m=>(i.length===0?m.delete(M):m.set(M,i),m),{replace:!0,preventScrollReset:!0}),c(i),o(i)},[r,o]);return{searchDebounced:g,searchField:n,handleSearch:h}},F="sortBy",L="order",Ae=s=>{const[t,r]=k(),l=q(t.get(F)??"",t.get(L)??""),n=s.find(a=>a===l),[c,g]=d.useState(n??s[0]),[u,o]=H(c);d.useEffect(()=>{n||r(a=>(a.delete(F),a.delete(L),a),{replace:!0,preventScrollReset:!0})},[n,r]);const h=d.useCallback(a=>{const p=a.target.value;g(p);const[i,m]=H(p);m&&r(x=>(p===s[0]?(x.delete(F),x.delete(L)):(x.set(F,i),x.set(L,m)),x),{replace:!0,preventScrollReset:!0})},[r,s]);return{sortBy:u,order:o,sortSelectValue:c,handleChangeSort:h}},v="limit",Me=s=>{const[t,r]=k(),l=Number(t.get(v)??""),n=s.find(o=>o===l),[c,g]=d.useState(n??s[0]);d.useEffect(()=>{n||r(o=>(o.delete(v),o),{replace:!0,preventScrollReset:!0})},[n,r]);const u=d.useCallback(o=>{const h=Number(o.target.value);g(h),r(a=>(h===s[0]?a.delete(v):a.set(v,String(h)),a),{replace:!0,preventScrollReset:!0})},[r,s]);return{limit:c,handleChangeLimit:u}},w=30,R=["id|desc","id|asc","views|desc"],j=[9,18,36],ke=()=>{const s=se(),[t,r]=le(s.pagination,P.base),{searchDebounced:l,searchField:n,handleSearch:c}=Ne(w),{sortBy:g,order:u,sortSelectValue:o,handleChangeSort:h}=Ae(R),{limit:a,handleChangeLimit:p}=Me(j);let i,m=Array(a).fill(null);const x=ce(t,a),{data:C,isLoading:z,isFetching:_,isError:X}=$({limit:a,skip:x,search:l,sortBy:g,order:u},{skip:!r});!z&&C&&(m=C.posts,i=C.total);const O=ie({limit:a,total:i,currentPage:t,paginationUrlCallback:f=>P.pagination(f)}),{isFetching:B}=E(O,_),{isFetching:J}=E(a,_),{isFetching:W}=E(q(g,u??""),_),{isFetching:Z,isLoadingDelay:ee,lastQuery:N}=E(l,_),D=B||J||W||Z,y=d.useId();return e.jsxs(G,{title:"All blog posts",children:[e.jsxs(fe,{children:[e.jsx(ye,{"aria-label":"Blog search",onSubmit:f=>f.preventDefault(),children:e.jsx(ne,{type:"search",icon:"search",name:"search",placeholder:"Enter your query",value:n,label:"Search posts",onChange:c,maxLength:w,isLoading:ee,"aria-controls":y})}),e.jsxs("div",{className:pe["filter-select-group"],children:[e.jsxs(S,{label:"Sort by",value:o,onChange:h,"aria-controls":y,children:[e.jsx(S.Option,{value:R[0],children:"Newest to oldest"}),e.jsx(S.Option,{value:R[1],children:"Oldest to newest"}),e.jsx(S.Option,{value:R[2],children:"Most interesting"})]}),e.jsxs(S,{label:"Show by",value:String(a),onChange:p,"aria-controls":y,children:[e.jsx(S.Option,{value:String(j[0]),children:j[0]}),e.jsx(S.Option,{value:String(j[1]),children:j[1]}),e.jsx(S.Option,{value:String(j[2]),children:j[2]})]})]})]}),e.jsx(K,{id:y,isFetching:D,hiddenMessage:b.postsLoading,children:e.jsxs(Q,{isError:X,errorMessage:V.postsLoad,children:[e.jsx(Ce,{field:n,lastQuery:N,total:i}),e.jsx(T,{isFetching:D,children:i===0&&N?e.jsx(Y,{message:b.postsNotFound(N)}):e.jsx(T.Posts,{posts:m,stretchLast:!0})}),O&&i?e.jsx(de,{limit:a,total:i,currentPage:O,urlBase:P.base,urlCallback:f=>P.pagination(f),isLoading:B}):null]})})]})},Ye=()=>(he("Home"),e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"The blog"}),e.jsx(Se,{isAboveTheFold:!0}),e.jsx(ke,{})]}));export{Ye as default};
